# 基于大语言模型（LLM）的自动化数据集生成平台

## 目录

- [工具简介](#工具简介)
- [一、启动服务](#一启动服务)
- [二、配置文件](#二配置文件)
- [三、前端使用指南](#三前端使用指南)
- [四、后台命令行使用指南](#四后台命令行使用指南)
- [五、常见问题](#五常见问题)

---

## 工具简介

大语言模型（LLM）的自动化数据集生成平台是一个AI数据集合成工具，能够从文档中自动提取内容，生成问题并生成答案，最终形成结构化的问题数据集。

**支持的功能：**
- 文档上传和自动切片
- AI 自动生成问题
- AI 自动生成答案（可选思维链）
- 数据集导出（Alpaca、ShareGPT、自定义格式）

---

## 一、启动服务

### 1.1 安装依赖

```bash
pip install -r requirements.txt
```

### 1.2 启动前端服务

使用以下命令启动 Web 服务：

```bash
python app.py
```

启动后，打开浏览器访问：**http://127.0.0.1:5000**

---

## 二、配置文件

配置文件 `config.json` 位于项目根目录，首次使用需要根据实际情况修改。

### 2.1 必填配置

**llm_provider** - LLM 提供商


**llm_model** - 模型名称


**llm_api** - API 地址

示例值：`https://api.deepseek.com/v1/chat/completions`


---

### 2.2 数据集配置

**default_dataset_format** - 数据集格式

- `alpaca` - Alpaca 格式（默认）
- `sharegpt` - ShareGPT 格式
- `custom` - 自定义格式

**default_dataset_file_type** - 导出文件类型

- `jsonl` - JSONL 格式（默认）
- `json` - JSON 格式

---

### 2.3 提示词配置

可根据需求自定义提示词以控制生成质量：

**system_prompt** - 系统提示词，定义 AI 角色

**generate_prompt** - 问题生成提示词

**answer_prompt** - 答案生成提示词

**chain_of_thought_prompt** - 思维链生成提示词

---

### 2.4 文档处理配置

**chunk_size** - 文档切片大小（字符数）

默认值：5000

**chunk_overlap** - 切片重叠大小

默认值：100

---

### 2.5 LLM 生成配置

**max_tokens** - 最大生成 token 数

默认值：8192

**temperature** - 生成温度（0-1，越低越稳定）

默认值：0.7

---

## 三、前端使用指南

### 3.1 界面介绍

前端包含以下页面：

- **介绍页面**：工具介绍和使用流程
- **执行页面**：主要操作界面，上传文档、执行命令
- **项目页面**：查看和管理所有项目
- **配置页面**：修改系统配置

### 3.2 完整使用流程

#### 第一步：上传文档

1. 进入**执行页面**
2. 拖拽文档文件到上传区域，或点击选择文件
3. 支持格式：PDF、DOC、DOCX、TXT、MD

#### 第二步：文档切片

1. 在命令选择框选择 **文档切片（chunk_documents）**
2. 点击 **执行命令**
3. 等待切片完成

#### 第三步：生成问题

1. 选择命令 **生成问题（generate_questions）**
2. 点击 **执行命令**
3. 等待问题生成完成

#### 第四步：生成答案

1. 选择命令 **生成答案（generate_answers）**
2. 选择答案生成模式：
   - **包含思维链**：生成答案和推理过程
   - **不包含思维链**：仅生成答案
3. 点击 **执行命令**
4. 等待答案生成完成

#### 第五步：创建数据集

1. 选择命令 **创建数据集（create_dataset）**
2. 点击 **执行命令**

#### 第六步：导出数据集

1. 选择命令 **导出数据集（export_dataset）**
2. 点击 **执行命令**
3. 下载生成的数据集文件

### 3.3 项目管理

#### 查看项目列表

进入**项目页面**，可以看到所有项目的卡片视图，包括：
- 项目名称
- 待回答问题数
- 已回答问题数
- 已审核问题数

#### 管理项目问题

1. 点击项目卡片进入详情
2. 可以筛选不同状态的问题（未回答/已回答/已审核）
3. 支持编辑问题、重新生成、删除等操作

### 3.4 配置管理

进入**配置页面**可以：

- 查看当前配置
- 修改 LLM 配置
- 设置 API 密钥（存储在内存中，重启后需重新设置）
- 调整提示词和生成参数

---

## 四、后台命令行使用指南

如果不使用前端界面，可以直接通过 `main.py` 命令完成数据合成。

### 4.1 命令格式

```bash
python main.py --project <项目名称> [参数选项]
```

### 4.2 命令参数

**基础参数**

`--config` - 配置文件路径

默认值：config.json

`--project` - 项目名称（必填）

指定要操作的项目

**文档相关**

`--document` - 文档文件路径

指定要导入的文档文件（支持 PDF、DOC、DOCX、TXT、MD）

`--import_questions` - 导入问题的 XLSX 文件路径

从 Excel 文件导入已有问题

**问题生成**

`--generate_questions` - 生成问题标志

添加此参数后，会基于文档内容自动生成问题

**答案生成**

`--generate_answers` - 生成答案（含思维链）

添加此参数后，会为问题生成答案和推理过程

`--generate_answers_no_chain` - 生成答案（不含思维链）

添加此参数后，仅生成答案，不包含推理过程

**数据集操作**

`--create_dataset` - 创建数据集名称

指定创建的数据集名称

`--export_dataset` - 导出数据集名称

指定要导出的数据集名称

### 4.3 完整使用流程示例

#### 示例1：完整流程（从文档到数据集）

```bash
# 一步完成：导入文档、生成问题、生成答案、创建并导出数据集
python main.py --project 我的项目 \
  --document /path/to/document.pdf \
  --generate_questions \
  --generate_answers \
  --create_dataset my_dataset \
  --export_dataset my_dataset
```

执行后会提示输入 API KEY：
```
需要 LLM API KEY (provider: openai)
请输入 API KEY: sk-xxxxxxxxxxxxx
```

#### 示例2：分步执行

```bash
# 1. 导入文档并切片
python main.py --project 我的项目 --document /path/to/document.pdf

# 2. 生成问题
python main.py --project 我的项目 --generate_questions

# 3. 生成答案（含思维链）
python main.py --project 我的项目 --generate_answers

# 4. 创建数据集
python main.py --project 我的项目 --create_dataset my_dataset

# 5. 导出数据集
python main.py --project 我的项目 --export_dataset my_dataset
```

#### 示例3：生成不含思维链的答案

```bash
python main.py --project 我的项目 \
  --document /path/to/document.pdf \
  --generate_questions \
  --generate_answers_no_chain \
  --create_dataset my_dataset \
  --export_dataset my_dataset
```

#### 示例4：使用自定义配置文件

```bash
python main.py --config my_config.json --project 我的项目 \
  --document /path/to/document.pdf \
  --generate_questions \
  --generate_answers
```

#### 示例5：导入已有问题并生成答案

```bash
python main.py --project 我的项目 \
  --import_questions /path/to/questions.xlsx \
  --generate_answers \
  --create_dataset my_dataset \
  --export_dataset my_dataset
```


### 4.4 输出说明

执行命令后，控制台会输出处理进度：

```
正在处理文档: /path/to/document.pdf
文档已分割为 15 个文本块
正在生成问题...
已为文档 document.pdf 生成 45 个问题
正在生成答案和思维链...
已为 45 个问题生成答案和思维链
正在创建数据集 'my_dataset'...
已将 45 个已回答的问题添加到数据集 'my_dataset'
正在导出数据集 'my_dataset'...
数据集已导出到: ./data/projects/我的项目/datasets/my_dataset.jsonl
```

---

## 五、常见问题

### Q1: API KEY 如何获取？

- **OpenAI**: 访问 https://platform.openai.com/api-keys
- **DeepSeek**: 访问 https://platform.deepseek.com/

### Q2: 支持哪些文档格式？

PDF、DOC、DOCX、TXT、XLSX、MD

### Q3: 导出的数据集在哪里？

数据集保存在 `./data/projects/<项目名>/datasets/` 目录下

### Q4: 如何调整生成质量？

- 降低 `temperature` 值（如 0.1-0.3）获得更稳定的输出
- 优化 `generate_prompt` 和 `answer_prompt` 提示词
- 调整 `chunk_size` 控制上下文范围

### Q5: 前端无法启动？

- 检查端口 5000 是否被占用
- 确认已安装所有依赖 `pip install -r requirements.txt`

### Q6: 命令行执行报错？

- 确认文档文件路径正确
- 检查 API KEY 格式是否正确
- 查看错误日志获取详细信息

### Q7: 报错没有python3命令

- 请检查python环境并推荐python3与python指向相同的解释器

### Q8: 创建项目后无法直接导入问题

- 请至少先成功创建切片后再导入问题
